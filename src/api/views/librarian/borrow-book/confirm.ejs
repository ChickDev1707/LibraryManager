<%- contentFor('head') %> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src ="../../../../public/js/borrow-book.js"></script>
<%-contentFor('body') %>
<%- include('../../partials/header/librarian-header.ejs') %> 
<div class="container d-flex flex-column justify-content-center mw-100" id="mainContainer">
    <div 
        class="position-absolute top-0 end-0 mt-3 me-3 w-20 d-flex flex-column" 
        id="alert_container" 
        style="z-index: 100; max-width: 25%; max-height: 90%;"
    >   
        <% if (error) { %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong><%=message %> !</strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>
    </div>
    <form 
        class="container search-container mb-3"
        action="/librarian/borrow/confirm" 
    >
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <select class="form-select form-control" name="search_option" id="search-option">
                    <option value="id" <%=option=="id"?"selected":"" %> > 
                        ID
                    </option>
                    <option value="email" <%=option=="email"?"selected":"" %>> 
                        Email
                    </option>
                </select>
            </div>
            <input 
                name="search_string"
                id="search_string"  
                type="text" 
                class="form-control text-truncate"
                value="<%=searchString%>"
                required 
            />
            <button class="btn btn-primary" type="submit">Tìm kiếm</button>
        </div>
    </form>

    <div 
        class="container d-flex flex-column justify-content-center align-content-center"
        action="/librarian/borrow/confirm" 
        method="post"
    > 
    <div class="container reader-container mb-3 p-0">
        <div class="row justify-content-center mb-1">
            <h5 class="text-center">Thông tin độc giả</h5>
        </div>
        <div class="row">
            <div class="col input-group mb-3">
                <span class="input-group-text" id="basic-addon1">
                    ID:
                </span>
                <input 
                    name="reader_id" 
                    id="reader_id"  
                    type="text" 
                    class="form-control text-truncate"
                    value="<%= reader?reader._id:'' %>"
                    disabled 
                />
            </div>
            <div class="col input-group mb-3">
                <span class="input-group-text" id="basic-addon1">
                    Email:
                </span>
                <input 
                    name="email" 
                    id="email"  
                    type="email" 
                    class="form-control text-truncate"
                    value="<%= reader?reader.email:'' %>" 
                    disabled 
                />
            </div>
        </div>
        <div class="row">
            <div class="col input-group mb-3">
                <span class="input-group-text" id="basic-addon1">
                    Họ và Tên:
                </span>
                <input 
                    name="ho_ten" 
                    id="ho_ten"  
                    type="text" 
                    class="form-control text-truncate"
                    value="<%= reader?reader.ho_ten:'' %>"
                    disabled 
                />
            </div>
            <div class="col input-group mb-3">
                <span class="input-group-text" id="basic-addon1">
                    Ngày sinh
                </span>
                <input 
                    name="ngay_sinh" 
                    id="ngay_sinh"  
                    type="text" 
                    class="form-control text-truncate"
                    value="<%= reader?reader.ngay_sinh.toLocaleDateString("en-GB"):'' %>" 
                    disabled 
                />
            </div>
        </div>
        <div class="row">
            <div class="col input-group mb-3">
                <span class="input-group-text" id="basic-addon1">
                    Tiền nợ
                </span>
                <input 
                    name="tien_no" 
                    id="tien_no"  
                    type="number" 
                    class="form-control text-truncate"
                    value="<%= reader?reader.tien_no:'' %>"
                    disabled 
                />
            </div>
            <div class="col input-group mb-3">  
                <span class="input-group-text" id="basic-addon1">
                    Ngày mượn
                </span>
                <input 
                    name="ngay_muon" 
                    id="ngay_muon"  
                    type="date" 
                    class="form-control text-truncate"
                    value ="<%= new Date(Date.now()).toLocaleDateString('en-GB').split('/').reverse().join('-') %>"
                />
            </div>
        </div>
    </div>
    
        <div class="container mb-3  p-0 ">
            <h3 class="text-center mb-2">Danh sách phiếu mượn trả của độc giả</h3>
            <table class="table align-middle text-center table-striped position-relative">
                <thead class="table-dark">
                    <tr> 
                        <th scope="col" >Mã phiếu mượn</th>                  
                        <th scope="col">Tên sách</th>
                        <th scope="col">Ngày mượn</th>
                        <th scope="col">Tình trạng</th>      
                        <th scope="col">Xác nhận</th>
                    </tr>
                </thead>
            
                <tbody>
                    <% if (borrowCards!=null) { %>
                        <% borrowCards.forEach(borrowCard => { %>
                            <tr>
                                <td ><%= borrowCard._id %></td>
                                <td class="book_name" id="name_<%= borrowCard._id %>"><%= borrowCard.dau_sach.ten_dau_sach %></td>
                                <td class="date_borow" id="date_borow_<%= borrowCard._id %>"><%= borrowCard.ngay_muon.toLocaleDateString('en-GB')%></td>
                                <td class="status" id="sts_<%= borrowCard._id %>"><%= borrowCard.tinh_trang==0?"Chưa nhận sách":borrowCard.tinh_trang==1?"Đã nhận sách": "Đã trả sách" %></td>
                                
                                <td>
                                    
                                    <input 
                                        type="checkbox" 
                                        name="xac_nhan"
                                        value="<%= borrowCard._id %>"  
                                        style="height: 25px;width: 25px;" 
                                        class="confirm_input"
                                        <%= borrowCard.tinh_trang==0?"":"disabled"%> 
                                    />
                                </td>
                            </tr>
                        <% }) %>
                    <% } %>
                </tbody>
            </table>
            <div class="d-flex flex-row justify-content-center">
                <button class="btn btn-primary btn-large" onclick="subConfirm()">Xác nhận lấy sách</button>
            </div> 
        </div>
    </div>
</div>
