<%- contentFor('head') %> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src ="../../../../public/js/fine.js"></script>
<%- contentFor('body') %> 
<%- include('../../partials/header/librarian-header.ejs') %> 
<div class="container">
    <div 
        class="position-absolute top-0 end-0 mt-3 me-3 w-20 d-flex flex-column" 
        id="alert_container" 
        style="z-index: 9999; max-width: 25%; max-height: 90%;"
    >
        
    </div>
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <select class="form-select form-control" name="search_book_option" id="search-book-option">
                <option value="tatCa" > 
                    Tất cả
                </option>
                <option value="email"> 
                    Email
                </option>
                <option value="hoTen" > 
                    Họ và Tên độc giả
                </option>
                <option value="maDocGia" > 
                    Mã độc giả
                </option>
                
            </select>
        </div>
        <input 
            name="search_book_string"
            id="search_book_string"  
            type="text" 
            class="form-control text-truncate"
            value=""
            required 
        />
        <button class="btn btn-primary" type="button" onclick="search()">Tìm kiếm</button>
    </div>
    <table class="table align-middle text-center table-striped position-relative" id="readers_table">
        <thead class="table-dark">
            <tr>
                <th class="w-20">ID</th>
                <th>Email</th>
                <th>Họ và Tên</th>
                <th>Tiền nợ</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <% fineData.forEach(reader => { %>
                <tr  maDocGia="<%= reader._id %>" email="<%= reader.email %>" hoTen="<%= reader.ho_ten %>">
                    <td class="mw-20"><%= reader._id %> </td>
                    <td ><%= reader.email %> </td>
                    <td><%= reader.ho_ten %></td>
                    <td class="tien_no" id="tien_no_<%= reader._id %>"><%= Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(reader.tien_no)  %> </td>
                    <td>
                        <button 
                            type="button" 
                            data-bs-toggle="modal" 
                            data-bs-target="#payModal" 
                            <%= reader?"":"disabled" %>  
                            class="btn btn-primary" 
                            onclick="payFine('<%= JSON.stringify(reader) %>')"
                        >
                            Thanh toán
                        </button>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>

    <div class="modal fade " id="payModal" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-xs-down" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <strong>Thanh toán nợ</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="col input-group mb-3">
                        <span class="input-group-text">
                            ID
                        </span>
                        <input 
                            name="id" 
                            id="id"  
                            type="text" 
                            class="form-control text-truncate"
                            value=""
                            disabled 
                        />
                    </div>

                    <div class="col input-group mb-3">
                        <span class="input-group-text">
                            Email
                        </span>
                        <input 
                            name="email" 
                            id="email"
                            type="text" 
                            class="form-control text-truncate"
                            value=""
                            disabled 
                        />
                    </div>

                    <div class="col input-group mb-3">
                        <span class="input-group-text">
                            Họ và Tên
                        </span>
                        <input 
                            name="ho_ten" 
                            id="ho_ten"
                            type="text" 
                            class="form-control text-truncate"
                            value=""
                            disabled 
                        />
                    </div>
                    

                    <div class="col input-group mb-3">
                        <span class="input-group-text">
                            Tiền nợ
                        </span>
                        <input 
                            name="tien_no" 
                            id="tien_no"  
                            type="number" 
                            class="form-control text-truncate"
                            value=""
                            disabled 
                        />
                    </div>

                    <div class="col input-group mb-3">
                        <span class="input-group-text" >
                            Số tiền thanh toán
                        </span>
                        <input 
                            name="tien_thanh_toan" 
                            id="tien_thanh_toan"  
                            type="number" 
                            class="form-control text-truncate"
                            value=""
                            min="0" 
                            onchange="changePayMoney()"
                        />
                    </div>

                    <div class="col input-group mb-3">
                        <span class="input-group-text" >
                            Còn nợ
                        </span>
                        <input 
                            name="con_lai" 
                            id="con_lai"  
                            type="number" 
                            class="form-control text-truncate"
                            value=""
                            disabled 
                        />
                    </div>
                    <div class="col input-group mb-3">
                        <span class="input-group-text" >
                            Ngày thanh toán
                        </span>
                        <input 
                            name="ngay_thanh_toan" 
                            id="ngay_thanh_toan"  
                            type="date" 
                            value="<%= new Date(Date.now()).toLocaleDateString('en-GB').split('/').reverse().join('-') %>"
                            class="form-control text-truncate" 
                            onchange="changePayMoney()"
                        />
                    </div>
                </div>
                <div class="d-flex flex-row justify-content-center mb-2">
                    <button class="btn btn-primary" onclick="submit()">
                        Thanh toán
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>